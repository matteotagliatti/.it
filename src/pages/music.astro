---
import { getTopTracks } from "../api/spotify";
import Bubble from "../components/Bubble.astro";
import BubbleContainer from "../components/BubbleContainer.astro";
import Item from "../components/Item.astro";
import Link from "../components/Link.astro";
import Photo from "../components/Photo.astro";
import Text from "../components/Text.astro";
import Layout from "../layouts/Layout.astro";

interface SpotifySong {
  name: string;
  artists: {
    name: string;
  }[];
  external_urls: {
    spotify: string;
  };
}

interface Song {
  name: string;
  artist: string;
  url: string;
}

const data = await getTopTracks();
let songs: Song[] | null = null;

if (data.items) {
  songs = data.items.map((song: SpotifySong) => {
    return {
      name: song.name,
      artist: song.artists[0].name,
      url: song.external_urls.spotify,
    };
  });
}
---

<Layout title="Music">
  <Item>
    <Photo />
    <BubbleContainer>
      <Bubble>
        <Text>
          <Link href="https://open.spotify.com/user/matteotagliatti">
            Spotify
          </Link> Top Tracks
        </Text>
      </Bubble>
      {
        songs.map((song) => {
          return (
            <Bubble href={song.url}>
              <Text>
                <Link>{song.name}</Link> by {song.artist}
              </Text>
            </Bubble>
          );
        })
      }
      <Bubble>
        <Text>
          Go <Link href="/" blank={false}>back</Link>
        </Text>
      </Bubble>
    </BubbleContainer>
  </Item>
</Layout>
